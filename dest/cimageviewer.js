"use strict";function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();!function(e,t){t.body;!function(){for(var e=0,t=["webkit","moz"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var i=(new Date).getTime(),r=Math.max(0,16.7-(i-e)),o=window.setTimeout(function(){t(i+r)},r);return e=i+r,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}();var n={touch:"ontouchend"in t,$:function(e,n,i){var r=i||"querySelector";return n&&n[r]?n[r](e):t[r](e)},$$:function(e,t){return this.$(e,t,"querySelectorAll")},encodeHTML:function(e,t){return(null==e?"":""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;").replace(/\'/g,"&#39;").replace(/\"/g,"&quot;").replace(/\r?\n/g,t||" ")},transition:function(e,t){e.style.transition=e.style.webkitTransition=t},transformOrigin:function(e,t,n){t=null==t?0:t,n=null==n?0:n,e.style.transformOrigin=e.style.webkitTransformOrigin=t+"px "+n+"px"},transform:function(e,t,n,i){t=null==t?0:t,n=null==n?0:n,e.style.transform=e.style.webkitTransform="translate3d("+t+"px,"+n+"px,0)"+(i>0?" scale("+i+")":"")},ondown:function(e,t){return n.touch?e.addEventListener("touchstart",t):e.addEventListener("mousedown",function(e){e.touches=[{pageX:e.pageX,pageY:e.pageY}],t.call(this,e)}),this},onmove:function(e,t){return n.touch?e.addEventListener("touchmove",t):e.addEventListener("mousemove",function(e){e.touches=[{pageX:e.pageX,pageY:e.pageY}],t.call(this,e)}),this},onup:function(e,t){return n.touch?(e.addEventListener("touchend",t),e.addEventListener("touchcancel",t)):e.addEventListener("mouseup",t),this},ontap:function(e,t){if(n.touch){var i=null,r=null,o=null,a=null;e.addEventListener("touchstart",function(e){1==e.touches.length&&(i=o=e.touches[0].pageX,r=a=e.touches[0].pageY),e.preventDefault(),e.stopPropagation()}),e.addEventListener("touchmove",function(e){null!=i&&(o=e.touches[0].pageX,a=e.touches[0].pageY)}),e.addEventListener("touchend",function(n){Math.pow(i-o,2)+Math.pow(r-a,2)<400&&t.call(e,n),i=null})}else e.addEventListener("click",t);return this},extend:function(){var e=void 0,t=void 0,i=void 0,r=void 0,o=void 0,a=void 0,s=arguments,l=s[0]||{},c=1,u=s.length,d=!1;for(n.isBoolean(l)&&(d=l,l=s[c]||{},c++),c===u?(l={},c--):n.isObject(l)||n.isFunction(l)||(l={});c<u;c++)if(null!=(e=s[c]))for(t in e)i=l[t],l!==(r=e[t])&&(d&&r&&((o=Array.isArray(r))||n.isObject(r))?(o?(o=!1,a=i&&Array.isArray(i)?i:[]):a=i&&n.isObject(i)?i:{},l[t]=n.extend(d,a,r)):void 0!==r&&(l[t]=r));return l},toggle:function(e,t){e.style.display=t?"":"none"}};Array.prototype.forEach.call(["Object","Function","String","Number","Array","Boolean",{type:"Img",key:"HTMLImageElement"}],function(e){n["is"+(e.type||e)]=function(t){return Object.prototype.toString.call(t)==="[object "+(e.key||e)+"]"}});var i=function(){function i(e){_classCallCheck(this,i),this._initData(e)}return _createClass(i,[{key:"__showHandler",value:function(){}},{key:"__hideHandler",value:function(){}},{key:"__slidestartHandler",value:function(){}},{key:"__slideendHandler",value:function(){}},{key:"__slidechangeHandler",value:function(){}},{key:"__clickHandler",value:function(){}},{key:"__downloadHandler",value:function(){}},{key:"_trigger",value:function(e,t){var i=this,r=i.__.opts;return e&&n.isString(e)&&[i["__"+e+"Handler"],i["_"+e+"Handler"],r["on"+e.toLowerCase()]].forEach(function(e){n.isFunction(e)&&e.call(i,t)}),i}},{key:"_initData",value:function(e){var t=this,r=0;t.__&&t.__.state&&t.__.state.show&&(r=1,t.hide());var o={opts:n.extend({},i.defaultOptions),state:{show:0,ani:0},elem:{iframe:null,prev:null,next:null,num:null,curNum:null,allNum:null,desc:null},content:"",items:{prev:{},cur:{},next:{}},view:{margin:10,padding:50,left:0,right:0,width:0,height:0},transform:{duration:250,move:0},version:{build:"CIV",version:"1.0.0"}};if(t.__=o,o.opts.list=[],n.isObject(e))for(var a in e)/^on\w/.test(a)&&n.isFunction(e[a])?o.opts[a.toLowerCase()]=e[a]:/^list$/i.test(a)?n.isArray(e[a])&&function(){var t=void 0,i=void 0;e[a].forEach(function(e,r){n.isImg(e)?(t=e.src,i=e.getAttribute("data-civ-desc")):(t=e.src||e,i=e.desc),o.opts.list.push({index:r,desc:i?n.encodeHTML(i):"",src:t,left:NaN,x:0,y:0,scale:1})})}():/^index$/i.test(a)?o.opts.index=parseInt(e[a]):o.opts[a]=e[a];return o.opts.index>=0&&o.opts.index<o.opts.list.length||(o.opts.index=0),o.opts.preload&&t._preloadImage(o.opts.list),r&&t.show(),t}},{key:"_initDlg",value:function(){var r=this,o=r.__,a=o.opts,s=o.view,l=o.elem,c=o.items,u=o.content,d=o.transform,v=o.state,p=l.iframe;p||((p=t.createElement("iframe")).style.cssText="position:fixed;top:0;left:0;width:100%;height:100%;border:0;z-index:"+(isNaN(a.zIndex)?i.defaultOptions.zIndex:a.zIndex),u="<style>\n                    *{margin:0;padding:0;border:0}\n                    body{background-color:#000;font:16px/1.5 sans-serif}\n                    body{background-color:"+a.background+'}\n                    a,a:hover{text-decoration:none}\n                    .civ,.civ-cont,.civ-item,.civ-item>div{position:absolute;top:0;left:0;right:0;bottom:0;overflow:hidden}\n                    .civ-ft{position:absolute;right:15px;bottom:20px;left:15px;z-index:10;display:-webkit-box;-webkit-box-align:center;overflow:hidden;font-size:14px;color:rgba(255,255,255,.6);}     \n                    .civ-page__cur{font-size:20px;font-weight:normal;color:#fff;}\n                    .civ-page__line{font-size:12px;font-style:normal;}\n                    .civ-tit{-webkit-box-flex:1;margin:2px 0 0 10px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;}\n                    .civ-arrow{position:absolute;top:50%;width:40px;height:40px;margin-top:-20px;color:#fff;}\n                    .civ-arrow::before,\n                    .civ-arrow::after{content:"";position:absolute;border-radius:3px;background:currentColor;}\n                    .civ-arrow::before{width:3px;height:32px;}\n                    .civ-arrow::after{width:32px;height:3px;}\n                    .civ-arrow--left{left:25px;-webkit-transform:rotate(-45deg);}\n                    .civ-arrow--right{right:25px;-webkit-transform:rotate(135deg);}\n                    </style>\n                    <div class="civ js_civ">\n                        <div class="civ-cont js_civ_list">\n                            <div class="civ-item js_civ_item prev"><div><img></div></div>\n                            <div class="civ-item js_civ_item cur"><div><img></div></div>\n                            <div class="civ-item js_civ_item next"><div><img></div></div>\n                        </div>\n                        <div class="civ-ft">\n                            <div class="civ-page js_civ_num">\n                                <strong class="civ-page__cur js_civ_num_cur"></strong> <i class="civ-page__line">⁄</i> <span class="civ-page__all js_civ_num_all"></span>\n                            </div>\n                            <h6 class="civ-tit js_civ_desc"></h6>\n                        </div>\n                        <a href="javascript:;" class="civ-arrow civ-arrow--left js_civ_prev"></a>\n                        <a href="javascript:;" class="civ-arrow civ-arrow--right js_civ_next"></a>\n                    </div>',l.iframe=p,o.content=u),t.body.appendChild(p);var f=p.contentDocument;f.write(u),f.close(),l.num=n.$(".js_civ_num",f),l.curNum=n.$(".js_civ_num_cur",f),l.allNum=n.$(".js_civ_num_all",f),l.desc=n.$(".js_civ_desc",f),l.allNum.innerHTML=a.list.length,n.toggle(l.num,!!a.orderNumber),l.prev=n.$(".js_civ_prev",f),l.next=n.$(".js_civ_next",f);var h=parseInt(e.innerWidth),_=parseInt(e.innerHeight);s.width=h,s.height=_;for(var m in c){var g=c[m]={};g.wrap=n.$(".js_civ_item."+m,f),g.div=n.$("div",g.wrap),g.img=n.$("img",g.wrap)}var w=function(e,t,i){var r=c.cur,o=r.zoom,a=h*i,s=_*i,l=(a-h)/i,u=(s-_)/i;e=Math.min(Math.max(e,0),l),t=Math.min(Math.max(t,0),u),i<=4&&e>=0&&e<=l&&t>=0&&t<=u&&(o.width=a,o.height=s,o.x=e,o.y=t,o.scale=i,n.transformOrigin(r.div,e,t),n.transform(r.div,-e,-t,i))},x=n.$(".js_civ_list",f),y=[],b=0;return n.ondown(x,function(e){v.show&&(y.length=0,e.touches.length&&Array.prototype.forEach.call(e.touches,function(e){y.push({x:e.pageX,y:e.pageY})}),r._trigger("slidestart")),e.preventDefault(),e.stopPropagation()}).onmove(x,function(e){var t=e.touches[0];if(t){var n=void 0,i=void 0,o=c.cur.zoom,l=o.scale,u=t.pageX,v=t.pageY;if(2==y.length&&2==e.touches.length){var p=e.touches[1].pageX,f=e.touches[1].pageY,_=(y[0].x+y[1].x)/2,m=(y[0].y+y[1].y)/2,g=Math.sqrt(Math.pow(y[1].x-y[0].x,2)+Math.pow(y[1].y-y[0].y,2)),x=Math.sqrt(Math.pow(p-u,2)+Math.pow(f-v,2))/g,k=(x-1)/(l*=x);n=o.x+_*k,i=o.y+m*k,w(n,i,l),y[0].x=u,y[0].y=v,y[1].x=p,y[1].y=f}else if(y.length&&a.list.length>1){var j=u-y[0].x,I=v-y[0].y;if((n=o.x-j/l)>0&&n<(o.width-h)/l)i=o.y-I/l,w(n,i,l);else if(j){var A=parseInt(d.move+j);-A>=s.left&&-A<=s.right&&(d.move=A,r._update(),b=1)}y[0].x=u,y[0].y=v}}e.preventDefault(),e.stopPropagation()}).onup(x,function(){y.length=0,b&&r._reset()}).ontap(x,function(){r._trigger("click")}).ontap(l.prev,function(){r.prev()}).ontap(l.next,function(){r.next()}),x.addEventListener("mousewheel",function(e){if(v.show){var t=c.cur.zoom,n=t.scale*(e.deltaY>0?.9:1/.9),i=e.clientX,r=e.clientY,o=n-t.scale,a=t.x+i*o/n,s=t.y+r*o/n;w(a,s,n)}e.preventDefault(),e.stopPropagation()}),r._initItems(),r}},{key:"_preloadImage",value:function(e,t){return n.isArray(e)||(e=[e]),n.isFunction(t)||(t=null),n.isArray(e)&&e.forEach(function(e,n){if(e&&e.src&&!e.width){var i=new Image;i.onload=i.onerror=i.onabort=function(r){r&&"load"==r.type?(e.width=i.width,e.height=i.height):e.src=null,i=null,t&&t(e,n)},i.src=e.src}else t&&t(e,n)}),self}},{key:"_initItems",value:function(){var e=this,t=e.__,i=t.opts,r=t.elem,o=t.view,a=t.items,s=t.transform,l=i.list.length,c=i.index>0&&i.index<l?parseInt(i.index):0,u=function(t,r){var s=a[t],l=i.list[r]||{};s.data=l,s.index!==l.index&&(s.index=l.index,l.src?s.img.src=l.src:s.img.removeAttribute("src"),e._preloadImage(l,function(e){var t=1,i=0,r=0;if(e.width){var a=o.width/e.width,l=o.height/e.height;a<l?(t=a,r=(e.height-o.height/t)/2):(t=l,i=(e.width-o.width/t)/2)}s.x=i=parseInt(i),s.y=r=parseInt(r),s.scale=t,s.zoom={width:0,height:0,x:0,y:0,scale:1},n.transformOrigin(s.img,i,r),n.transform(s.img,-i,-r,t),n.transformOrigin(s.div,0,0),n.transform(s.div,0,0,1)}))};return u("prev",(c-1+l)%l),u("cur",c),u("next",(c+1)%l),r.curNum.innerHTML=c+1,r.desc.innerHTML=a.cur.data.desc||"",e._setArrow(),s.move=0,e._update()._updateViewScroll(),e}},{key:"_update",value:function(e,t){var i=this,r=i.__,o=r.view,a=r.items,s=r.transform,l=o.width+o.margin,c=s.move;n.isFunction(t)||(t=null);var u=function(e,t){n.isArray(e)||(e=[]),t(a.prev,e[0]),t(a.cur,e[1]),t(a.next,e[2])};u([c-l,c,c+l],function(e,t){e._needMove=0;var n=e.left;n!=t&&(e.left=t,(n>=-l&&n<=l||t>=-l&&t<=l)&&(e._needMove=1))});var d=function(e){var t=e?"all "+s.duration+"ms ease":"";u(null,function(e,i){e._needMove&&n.transition(e.wrap,t)})},v=function(){u(null,function(e,t){e._needMove&&n.transform(e.wrap,e.left)})};return e?(d(!0),setTimeout(v,0),setTimeout(function(){d(!1),t&&t()},s.duration)):(v(),t&&t()),i}},{key:"_updateViewScroll",value:function(){var e=this,t=e.__,n=t.opts,i=t.view,r=i.width+i.margin;return i.left=n.loop||0!=n.index?-r:0,i.right=n.loop||n.index!=n.list.length-1?r:0,e}},{key:"_reset",value:function(e){var t=this,n=t.__,i=n.opts,r=n.state,o=n.view,a=n.items,s=n.transform,l=null;if(!r.ani){if(r.ani=1,null!=e&&(-e>=o.left||-e<=o.right)?t._trigger("slidestart"):e=s.move,Math.abs(e)>o.padding){var c=o.width+o.margin;e>0?(e=c,l=-1):(e=-c,l=1)}else e=0;s.move=e,t._update(!0,function(){if(l){o.width,o.margin;var e=function(e,t,n){a.prev=e,a.cur=t,a.next=n,i.index=t.index};1==l?e(a.cur,a.next,a.prev):-1==l&&e(a.next,a.prev,a.cur),s.move=0,t._initItems()}setTimeout(function(){r.ani=0},10),t._trigger("slideend"),l&&t._trigger("slidechange")})}return t}},{key:"_setArrow",value:function(){var e=this,t=e.__,i=t.opts,r=t.elem,o=(r.prev,r.next,i.list.length);return n.toggle(r.prev,o>1&&(i.loop||i.index>0)),n.toggle(r.next,o>1&&(i.loop||i.index<o-1)),e}},{key:"show",value:function(){var e=this,t=e.__.state;return t.show||(e._initDlg(),t.show=1,e._trigger("show")),e}},{key:"hide",value:function(e){var n=this,i=n.__,r=i.state,o=i.elem.iframe;return r.show&&(t.body.removeChild(o),r.show=0,n._trigger("hide",e||"hide")),n}},{key:"prev",value:function(){var e=this,t=e.__,n=t.opts,i=t.state,r=t.view,o=n.list.length;return i.show&&o>1&&(n.loop||n.index>0)&&e._reset(r.width),e}},{key:"next",value:function(){var e=this,t=e.__,n=t.opts,i=t.state,r=t.view,o=n.list.length;return i.show&&o>1&&(n.loop||n.index<o-1)&&e._reset(-r.width),e}},{key:"list",get:function(){return this.__.opts.list.map(function(e){return e.src})},set:function(e){var t=this,i=t.__.opts;n.isArray(e)&&t.list.join(",")!=e.join(",")&&(i.list=e,i.index=0,t._initData(i)._reset())}},{key:"index",get:function(){return this.__.opts.index},set:function(e){var t=this,n=t.__.opts;(e=parseInt(e))>=0&&e<=n.list.length-1&&(n.index=e,t._initItems())}},{key:"loop",get:function(){return this.__.opts.loop},set:function(e){var t=this,n=t.__.opts;e!=n.loop&&(n.loop=e,t._updateViewScroll())}},{key:"version",get:function(){return this.__.version}}]),i}();i.utils=n,e.CIV=e.cImageViewer=i}(window,document),function(e){var t;e.ANIMATION={TRANSLATE:"translate"},e.defaultOptions=(t={list:null,index:0,loop:!0,orderNumber:!0,arrow:!0,preload:!1,saveBtn:"保存图片",save:!1},_defineProperty(t,"saveBtn","保存图片"),_defineProperty(t,"background","#000"),_defineProperty(t,"animation",e.ANIMATION.TRANSLATE),_defineProperty(t,"zIndex",99999),t)}(window.CIV),function(e,t,n){var i=n.utils,r=function(r){function o(e){_classCallCheck(this,o);var t=_possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,e)),n=t.__;return n.elem.save=null,n.version.build="CIV_QM",t}return _inherits(o,n),_createClass(o,[{key:"_showHandler",value:function(){var e=this,t=e.__,n=t.opts,r=t.elem,o=r.iframe.contentDocument,a=o.createElement("div");a.innerHTML='<style>\n                .civ-btn{position:absolute;padding:0 1em;bottom:50px;width:140px;line-height:40px;left:50%;margin-left:-70px;background:rgba(0,0,0,.5);color:#fff;border:2px solid #fff;border-radius:20px;overflow:hidden;text-overflow:ellipsis;}\n                </style>\n                <button class="civ-btn js_save" style="'+(n.save?"":"display:none")+'">'+n.saveBtn+"</button>",o.body.appendChild(a),r.save=i.$(".js_save",o),i.ontap(r.save,function(){e._save()})}},{key:"_save",value:function(){var n=this,r=n.__,o=(r.opts,r.items.cur);if(o.img){var a=o.img.src;if(a){var s=function(e){var t={img:a,index:o.index};e&&0!=e.code&&(t.error=e),n._trigger("save",t)};if(e.M&&M.client){if(i.isFunction(M.client.open))return M.client.open("media","saveImage",{content:a},s),n;if(i.isFunction(M.client.invoke))return M.client.invoke("media","saveImage",{content:a},s),n}var l=t.createElement("a");l.href=a,l.target="_blank";var c=a.split(/[#?]/);c=c[0].match(/[\w.]+$/),l.download=c&&c[0]||"save.jpg",l.click(),s()}}return n}},{key:"save",get:function(){return this.__.opts.save},set:function(e){var t=this.__,n=t.opts,i=t.elem;n.save=!!e,i.btn.style.display=n.save?"block":"none"}},{key:"saveBtn",get:function(){return this.__.opts.saveBtn},set:function(e){var t=this.__,n=t.opts,i=t.elem;(e=""+e)!=n.saveBtn&&(n.saveBtn=e,i.btn.innerText=e)}}]),o}();r.defaultOptions.save=!1,r.defaultOptions.saveBtn="保存图片",e.CIV=e.cImageViewer=r}(window,document,window.CIV);